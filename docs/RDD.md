# 第一フェーズ：営業リスト管理システム要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
営業リスト管理システム（Phase 1）

### 1.2 目的・背景
- **現状の課題**: スプレッドシートによる企業リスト管理の非効率性
- **解決したい問題**: 
  - データ管理の煩雑さ
  - 検索・フィルタ機能の不足
  - 案件ごとの営業ステータス管理の困難
  - Facebook DM送信業務の前工程効率化
- **期待効果**: 
  - 営業リスト管理の効率化
  - 案件ベースでの進捗管理
  - 将来のAUTOBOOST的サービス展開への基盤構築

### 1.3 プロジェクトスコープ
- **対象業務**: 企業リスト管理、案件管理、営業ステータス管理
- **対象ユーザー**: バジェットアドテクノロジー社員（20名程度）
- **対象データ**: 企業情報（数万社）、代表者・役員情報、案件情報

---

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 企業データ管理機能
- **企業基本情報の管理**
  - 企業名、業界、従業員数、売上高、所在地、設立年
  - 企業HP URL、連絡先情報
  - 備考・メモ機能
  
- **代表者・役員情報の管理**
  - 氏名、役職、Facebook URL、その他SNS URL
  - 直通メールアドレス、備考

- **グローバルNG企業設定**
  - 全案件共通のNG企業設定
  - NG理由の記録

#### 2.1.2 案件管理機能
- **案件基本情報の管理**
  - 案件名、依頼企業名、案件概要、担当者
  - 案件ステータス（進行中/完了/中止）

- **案件企業リスト管理**
  - 案件への企業追加・削除
  - 案件ごとのNG企業設定

#### 2.1.3 営業ステータス管理機能
- **ステータス管理**
  - 企業×案件単位でのステータス管理
  - ステータス: 未接触→DM送信予定→送信済み→返信あり→アポ獲得→成約→NG
  - 接触日、担当者、メモの記録

- **一括操作機能**
  - 複数企業の一括ステータス更新
  - 一括案件追加

#### 2.1.4 検索・フィルタ機能
- **基本検索**
  - 企業名での部分一致検索
  - フリーワード検索

- **詳細フィルタ**
  - 業界、従業員数、売上高、都道府県、設立年での絞り込み
  - Facebook URL有無での絞り込み
  - NG企業の自動除外

- **保存済みフィルタ機能**
  - 検索条件の名前付き保存
  - 保存済み条件の再利用

#### 2.1.5 データ連携機能
- **CSVインポート**
  - 企業データの一括インポート
  - データ形式チェック・重複チェック
  - インポート結果レポート

- **CSVエクスポート**
  - 検索結果の CSV出力
  - 案件データの CSV出力

#### 2.1.6 表示制御機能
- **ランダム表示機能**
  - 初回アクセス時の自動ランダム表示
  - ユーザーごとの表示順序保持
  - シャッフル機能

### 2.2 非機能要件

#### 2.2.1 性能要件
- **レスポンス時間**: 通常操作3秒以内、検索機能5秒以内
- **同時接続数**: 最大20ユーザー
- **データ処理能力**: 企業データ数万件の管理
- **ページネーション**: 50/100/200件単位での表示切り替え

#### 2.2.2 可用性要件
- **稼働率**: 99%以上
- **メンテナンス時間**: 営業時間外（平日19:00-09:00、土日祝日）
- **バックアップ**: 日次自動バックアップ

#### 2.2.3 セキュリティ要件
- **認証**: メールアドレス・パスワード認証（Supabase Auth）
- **通信**: HTTPS通信必須
- **データ保護**: SQLインジェクション、XSS対策
- **アクセス制御**: ログイン必須、セッション管理

#### 2.2.4 運用要件
- **ログ管理**: システムアクセスログ、エラーログの記録
- **監視**: システム稼働監視、パフォーマンス監視
- **データ保持**: 企業データの永続保存、ログの3ヶ月保存

---

## 3. システム構成

### 3.1 技術スタック
- **フロントエンド**: React.js (Next.js 15)
- **バックエンド**: Django REST Framework 3.16
- **データベース**: PostgreSQL 15 (Docker Container)
- **認証**: JWT Authentication (SimpleJWT)
- **インフラ**: さくらのクラウド VPS (Phase 1) / App Run (Phase 2予定)
- **プロキシ**: Nginx + Let's Encrypt SSL
- **その他**: Redis（キャッシュ）、Whitenoise（静的ファイル配信）、Cloudflare（CDN/SSL）

### 3.1.1 リポジトリ構成
- **eastcloud-corp/saleslist-backend**: Django REST Framework API
- **eastcloud-corp/saleslist-front**: Next.js フロントエンド  
- **eastcloud-corp/saleslist-infra**: Docker・Terraform・GitHub Actionsインフラ設定

### 3.2 現在のシステム構成図（Phase 1 - VPS構成）
```
[Internet] → [Cloudflare CDN/SSL] → [さくらVPS: Nginx:443] → [Frontend:3000]
                                                           → [Backend:8000] → [PostgreSQL:5432]
                                                                           → [Redis:6379]
```

### 3.3 将来のシステム構成図（Phase 2 - App Run移行予定）
```
[Internet] → [Cloudflare CDN] → [App Run Frontend] → [App Run Backend] → [App Run Database]
                                                                       → [App Run Redis]
```

### 3.3 データベース設計
- **企業マスタ（companies）**: 企業基本情報
- **役員情報（executives）**: 代表者・役員情報
- **案件マスタ（projects）**: 案件基本情報
- **案件企業（project_companies）**: 案件と企業の関連、ステータス管理
- **保存済みフィルタ（saved_filters）**: 検索条件保存
- **案件NG企業（project_ng_companies）**: 案件ごとのNG企業設定

---

## 4. 画面設計

### 4.1 画面一覧
1. **ログイン画面** - ユーザー認証
2. **企業リスト画面** - メイン機能（検索・フィルタ・案件追加）
3. **企業詳細画面** - 企業情報詳細・編集
4. **案件管理画面** - 案件一覧・作成
5. **案件詳細画面** - 案件企業リスト・ステータス管理

### 4.2 主要画面の特徴
- **レスポンシブデザイン**: PC・タブレット対応
- **直感的UI**: 操作の分かりやすさを重視
- **効率的な操作フロー**: 最小クリック数での目標達成

---

## 5. API設計

### 5.1 RESTful API
- **Base URL**: `https://api.budget-sales.com/api/v1/`
- **認証方式**: Bearer Token (JWT)
- **データ形式**: JSON

### 5.2 実装済みAPIエンドポイント

#### 認証関連（/auth/）
- **POST /auth/login/**: JWT認証ログイン
- **POST /auth/logout/**: ログアウト
- **POST /auth/refresh/**: トークンリフレッシュ
- **GET /auth/me/**: ユーザー情報取得
- **POST /auth/register/**: ユーザー登録

#### 企業管理（/companies/）
- **GET/POST /companies/**: 企業一覧・作成
- **GET/PUT/PATCH/DELETE /companies/{id}/**: 企業詳細操作
- **GET /companies/search/**: 企業検索
- **POST /companies/import/**: CSVインポート
- **GET /companies/export/**: CSVエクスポート

#### 案件管理（/projects/）
- **GET/POST /projects/**: 案件一覧・作成
- **GET/PUT/PATCH/DELETE /projects/{id}/**: 案件詳細操作
- **GET/POST /projects/{id}/companies/**: 案件企業管理
- **GET /projects/{id}/statistics/**: 案件統計情報

#### 役員管理（/executives/）
- **GET/POST /executives/**: 役員一覧・作成
- **GET/PUT/PATCH/DELETE /executives/{id}/**: 役員詳細操作

#### マスターデータ（/master/）
- **GET /master/industries/**: 業界マスター
- **GET /master/statuses/**: ステータスマスター
- **GET /master/prefectures/**: 都道府県マスター

#### フィルタ管理（/saved_filters/）
- **GET/POST /saved_filters/**: 保存済みフィルタ
- **GET/PUT/DELETE /saved_filters/{id}/**: フィルタ詳細操作

#### NG企業管理（/ng-companies/）
- **GET /ng-companies/template/**: テンプレートダウンロード
- **POST /ng-companies/import/**: NGリストインポート

#### ダッシュボード（/dashboard/）
- **GET /dashboard/stats/**: 統計情報
- **GET /dashboard/recent-projects/**: 最近の案件
- **GET /dashboard/recent-companies/**: 最近の企業

#### ヘルスチェック
- **GET /health**: アプリケーション状態
- **GET /api/health/db**: データベース接続状態
- **GET /api/health/cache**: キャッシュ接続状態

---

## 6. 開発・運用計画

### 6.1 開発工程
- **画面数**: 5画面（CRUD画面3個、その他画面2個）
- **特殊機能**: 6個（CSV処理、フィルタ保存、ランダム表示等）
- **想定工数**: 17-36日（約3-7週間）

### 6.2 開発体制
- **フロントエンド**: React.js開発者
- **バックエンド**: Django開発者
- **インフラ**: さくらクラウド設定
- **テスト**: 機能テスト、結合テスト

### 6.3 リリース計画
- **α版**: 基本CRUD機能
- **β版**: 検索・フィルタ機能追加
- **本番版**: 全機能実装・テスト完了

---

## 7. インフラ構成・将来計画

### 7.1 Phase 1（現在）: VPS構成
**技術構成**:
- **VPS**: さくらのクラウド 2CPU/4GB/40GB SSD (約6,620円/月)
- **OS**: Ubuntu 22.04 LTS
- **Container**: Docker Compose
- **SSL**: Let's Encrypt (無料)
- **DNS**: Cloudflare (無料)
- **ドメイン**: sales-navigator.east-cloud.jp

**メリット**:
- 低コスト運用
- 完全な環境制御
- Docker Compose運用ノウハウ蓄積

**デメリット**:
- サーバー管理が必要
- スケーリング手動対応
- 運用負荷大

### 7.2 Phase 2（移行予定）: App Run構成
**技術構成**:
- **App Run**: Frontend/Backend/Database 分離
- **Container Registry**: さくら (約1,000円/月追加)
- **自動スケーリング**: トラフィック連動
- **マネージドサービス**: 運用負荷軽減

**移行メリット**:
- 運用負荷大幅軽減
- 自動スケーリング
- 高可用性・信頼性向上
- マネージドサービスの恩恵

**移行コスト**:
- **月額**: 6,620円 → 約11,000円（+4,380円）
- **移行作業**: Terraform設定済み（数時間）

### 7.3 App Run移行判定基準
- **ユーザー数**: 50名以上
- **アクセス数**: 月10万PV以上
- **運用負荷**: VPS管理が困難になった時点
- **予算**: 月額1万円以上の予算確保

### 7.4 次フェーズ予定機能
- **Phase 2**: Facebook検索機能、自動クローリング、App Run移行
- **Phase 3**: マルチテナント対応、権限管理
- **Phase 4**: AI活用、高度な分析機能

### 7.5 拡張性考慮事項
- **マルチテナント対応**: 全テーブルに`tenant_id`追加予定
- **外部API連携**: Facebook Graph API、メール送信API等
- **スケーラビリティ**: App Run自動スケーリング、マイクロサービス化

---

## 8. 運用情報（Phase 1）

### 8.1 本番環境情報
- **URL**: https://sales-navigator.east-cloud.jp
- **管理画面**: https://sales-navigator.east-cloud.jp/admin/
- **管理者アカウント**: budget_admin / Budget2025!
- **サーバー**: Ubuntu@153.120.128.27 (ssh ubuntu@153.120.128.27)

### 8.2 自動化機能
- **自動デプロイ**: GitHub Actions (push → 自動デプロイ)
- **自動バックアップ**: 毎日2時 (DB) → /var/log/salesnav/backup/database/YYYYMM/
- **ログローテーション**: 毎日 → /var/log/salesnav/backup/log/YYYYMM/
- **SSL更新**: 毎月1日 (Let's Encrypt自動更新)

### 8.3 監視・ログ
- **アプリケーションログ**: /var/log/salesnav/backend/, /var/log/salesnav/frontend/
- **ヘルスチェック**: /health, /api/health/db, /api/health/cache
- **アクセスログ**: Nginxアクセスログ (30日ローテーション)

### 8.4 セキュリティ設定
- **HTTPS**: Let's Encrypt + Cloudflare
- **SSH**: 鍵認証のみ
- **Django**: CSRF保護、XSS対策
- **JWT**: 1時間有効期限、3日間リフレッシュ

---

## 9. リスク・制約事項

### 8.1 技術的リスク
- **Facebook API制限**: 個人情報検索の制限強化の可能性
- **スケーラビリティ**: 大量データ処理時のパフォーマンス低下
- **外部依存**: Supabase サービス停止のリスク

### 8.2 運用リスク
- **データ移行**: 既存スプレッドシートからの移行作業
- **ユーザー教育**: 新システムの操作習得
- **データ品質**: 既存データの不整合・重複問題

### 8.3 制約事項
- **予算制約**: コスト最適化のため機能を段階的実装
- **開発期間**: 早期リリースのため最小限の機能に絞り込み
- **人的リソース**: 20名での利用のため大規模機能は後回し

---

## 9. 成功基準

### 9.1 機能面での成功基準
- **データ移行**: 既存企業データの100%移行完了
- **検索性能**: 数万件データでの3秒以内レスポンス達成
- **操作性**: ユーザーが従来比50%以上の効率向上を実感

### 9.2 運用面での成功基準
- **稼働率**: 99%以上の安定稼働
- **ユーザー満足度**: 従来のスプレッドシート運用と比較して満足度向上
- **拡張準備**: Phase 2への移行がスムーズに実行可能

---

## 10. 承認・合意事項

### 10.1 要件承認
- 本要件定義書の内容についてステークホルダーの合意を得る
- 機能範囲の変更は変更管理プロセスに従って実施

### 10.2 品質基準
- 機能テスト・結合テストの完了を必須とする
- ユーザビリティテストの実施

### 10.3 リリース判定
- 全機能の正常動作確認
- パフォーマンステストの合格
- セキュリティチェックの完了

---

**文書管理**
- 作成日: 2025年8月21日
- バージョン: 1.0
- 作成者: システム開発チーム
- 承認者: [承認者名]