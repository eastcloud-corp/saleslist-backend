# Vercel v0 用 システム仕様書

営業リスト管理システムをVercel v0で実装するための詳細仕様書です。

## プロジェクト概要

### システム名
営業リスト管理システム（Phase 1）

### 目的
企業リスト管理、案件管理、営業ステータス管理の効率化を図る業務システム

### 対象ユーザー
バジェットアドテクノロジー社員（20名程度）

---

## 技術スタック

### フロントエンド
- **フレームワーク**: Next.js 14 (App Router)
- **スタイリング**: Tailwind CSS
- **UIコンポーネント**: shadcn/ui
- **状態管理**: React Query (TanStack Query)
- **認証**: Supabase Auth
- **デプロイ**: Vercel

### バックエンド
- **API**: モックAPI (https://saleslist-mock-api.onrender.com)
- **認証**: Bearer Token (JWT)
- **データ形式**: JSON

---

## 画面設計

### 1. ログイン画面 (`/login`)

#### レイアウト・デザイン
```
┌─────────────────────────────┐
│        ログイン画面          │
├─────────────────────────────┤
│   営業リスト管理システム      │
│                             │
│   メールアドレス             │
│   [___________________]     │
│                             │
│   パスワード                │
│   [___________________]     │
│                             │
│       [ログイン]            │
│                             │
│   エラーメッセージ表示エリア   │
└─────────────────────────────┘
```

#### 機能要件
- メールアドレス・パスワードのバリデーション
- ログイン失敗時のエラー表示
- 成功時は企業リスト画面へリダイレクト
- レスポンシブデザイン（PC・タブレット対応）

#### API連携
- `POST /auth/login`

---

### 2. 企業リスト画面 (`/companies`)

#### レイアウト・デザイン
```
┌──────────────────────────────────────────────────────────────┐
│ Header: 企業リスト | 案件管理 | ログアウト                      │
├──────────────────────────────────────────────────────────────┤
│ Search & Filter Section:                                     │
│ [検索___] [業界▼] [従業員数_-_] [売上高_-_] [都道府県▼] [検索] │
│ [フィルタクリア] [保存済みフィルタ▼] [条件保存]              │
├──────────────────────────────────────────────────────────────┤
│ Actions:                                                     │
│ [シャッフル] [NG除外☑] [件数50▼] [CSV取込] [CSV出力] [案件追加] │
├──────────────────────────────────────────────────────────────┤
│ Table:                                                       │
│ ☑ | 企業名 | 業界 | 従業員数 | 都道府県 | 代表者 | FB | NG | 操作│
│ ☑ | 株式会社A | IT | 150 | 東京都 | 田中太郎 | ○ | - | [詳細]│
│ ☑ | 株式会社B | 製造 | 300 | 大阪府 | 佐藤花子 | ○ | NG | [詳細]│
├──────────────────────────────────────────────────────────────┤
│ Pagination: [<] 1 2 3 ... 100 [>] | 総件数: 25,000件      │
└──────────────────────────────────────────────────────────────┘
```

#### 機能要件
- **検索・フィルタ機能**:
  - フリーワード検索（企業名）
  - 業界、従業員数、売上高、都道府県、設立年でのフィルタ
  - Facebook URL有無での絞り込み
  - NG企業の除外機能

- **表示制御**:
  - ランダム表示機能（初回アクセス時）
  - ページネーション（50/100/200件切り替え）
  - シャッフル機能

- **データ操作**:
  - CSVインポート・エクスポート
  - 複数企業選択
  - 案件への一括追加

- **保存済みフィルタ**:
  - 検索条件の名前付き保存
  - 保存済み条件の呼び出し・削除

#### API連携
- `GET /companies/` - 企業一覧・検索・フィルタ
- `GET /master/industries/` - 業界マスタ
- `GET /master/prefectures/` - 都道府県マスタ
- `GET /saved_filters/` - 保存済みフィルタ一覧
- `POST /saved_filters/` - フィルタ保存
- `POST /companies/import_csv/` - CSV取込
- `GET /companies/export_csv/` - CSV出力

---

### 3. 企業詳細画面 (`/companies/[id]`)

#### レイアウト・デザイン
```
┌──────────────────────────────────────────────────────────────┐
│ Header: [← 戻る] 企業詳細 | [保存] [削除]                      │
├──────────────────────────────────────────────────────────────┤
│ 企業基本情報:                                                │
│ 企業名*: [________________________]                         │
│ 業界: [__________] 従業員数: [_____] 売上高: [____________]   │
│ 都道府県: [______] 市区町村: [______] 設立年: [______]      │
│ HP URL: [_________________________]                          │
│ 連絡先: [_________________________] TEL: [_____________]     │
│ 備考: [____________________________________________]         │
├──────────────────────────────────────────────────────────────┤
│ 代表者・役員情報: [+ 役員追加]                               │
│ ┌─────────────────────────────────────────────────┐          │
│ │ 氏名: 田中太郎 | 役職: 代表取締役                  │ [編集][削除] │
│ │ Facebook: https://facebook.com/tanaka          │          │
│ │ LinkedIn: https://linkedin.com/in/tanaka       │          │
│ │ メール: tanaka@example.com                     │          │
│ └─────────────────────────────────────────────────┘          │
├──────────────────────────────────────────────────────────────┤
│ NG設定:                                                      │
│ ☐ グローバルNG設定 理由: [_________________]                 │
├──────────────────────────────────────────────────────────────┤
│ 履歴: 作成日時: 2025-01-01 10:00 | 更新日時: 2025-01-15 15:30│
└──────────────────────────────────────────────────────────────┘
```

#### 機能要件
- **企業情報CRUD**:
  - 企業基本情報の表示・編集・保存・削除
  - バリデーション（必須項目チェック）

- **役員情報管理**:
  - 役員の追加・編集・削除
  - Facebook、LinkedIn URL管理

- **NG設定**:
  - グローバルNG設定の切り替え
  - NG理由の記録

#### API連携
- `GET /companies/{id}/` - 企業詳細取得
- `PUT /companies/{id}/` - 企業情報更新
- `DELETE /companies/{id}/` - 企業削除
- `GET /companies/{id}/executives/` - 役員一覧
- `POST /companies/{id}/executives/` - 役員追加
- `PUT /executives/{id}/` - 役員更新
- `DELETE /executives/{id}/` - 役員削除

---

### 4. 案件管理画面 (`/projects`)

#### レイアウト・デザイン
```
┌──────────────────────────────────────────────────────────────┐
│ Header: 案件管理 | [← 企業リストへ] [+ 新規案件作成]           │
├──────────────────────────────────────────────────────────────┤
│ Search:                                                      │
│ [案件名検索___] [依頼企業検索___] [ステータス▼] [期間____-____]│
├──────────────────────────────────────────────────────────────┤
│ Table:                                                       │
│ 案件名 | 依頼企業名 | ステータス | 企業数 | 作成日 | 更新日 | 操作│
│ IT企業向けDM | マーケ社 | 進行中 | 85社 | 01/01 | 01/20 | [詳細]│
│ 人材会社営業 | HR社 | 進行中 | 42社 | 01/05 | 01/22 | [詳細]  │
│ 製造業提案 | 工業社 | 完了 | 120社 | 12/01 | 01/10 | [詳細]  │
└──────────────────────────────────────────────────────────────┘
```

#### 機能要件
- **案件CRUD**:
  - 案件の作成・編集・削除
  - 案件検索（名前、依頼企業、ステータス、期間）

- **案件作成フォーム**:
  - 案件名、依頼企業名、概要、担当者の入力

#### API連携
- `GET /projects/` - 案件一覧・検索
- `POST /projects/` - 案件作成
- `PUT /projects/{id}/` - 案件更新
- `DELETE /projects/{id}/` - 案件削除

---

### 5. 案件詳細画面 (`/projects/[id]`)

#### レイアウト・デザイン
```
┌──────────────────────────────────────────────────────────────┐
│ Header: [← 案件管理へ] 案件詳細 | [企業を追加]                │
├──────────────────────────────────────────────────────────────┤
│ 案件情報: IT企業向けDMキャンペーン2025Q1 [編集]              │
│ 依頼企業: 株式会社マーケティングプロ | ステータス: 進行中      │
│ 担当者: 田中次郎 | 概要: IT企業向けの新サービス紹介DM送信     │
├──────────────────────────────────────────────────────────────┤
│ 進捗サマリー:                                               │
│ 未接触:20社 DM予定:15社 送信済:30社 返信あり:10社 アポ:8社 成約:2社│
├──────────────────────────────────────────────────────────────┤
│ 企業リスト操作: [一括ステータス更新▼] [CSV出力]              │
├──────────────────────────────────────────────────────────────┤
│ Table:                                                       │
│☑| 企業名 | 業界 | 代表者 | ステータス▼ | 接触日 | 担当 | メモ | 操作│
│☑| 株式A | IT | 田中 | DM送信済み▼ | 01/15 | 田中 | [____] | [NG][削除]│
│☑| 株式B | IT | 佐藤 | 返信あり▼ | 01/16 | 佐藤 | [____] | [NG][削除]│
├──────────────────────────────────────────────────────────────┤
│ Pagination: [<] 1 2 3 [>] | 85社中1-50社表示               │
└──────────────────────────────────────────────────────────────┘
```

#### 機能要件
- **案件情報表示**:
  - 案件基本情報の表示・編集
  - 進捗サマリー（ステータス別企業数）

- **企業管理**:
  - 案件企業一覧表示
  - 個別ステータス更新（プルダウンで即座に更新）
  - 一括ステータス更新
  - 企業の案件からの除外
  - 案件固有NG設定

- **データ出力**:
  - 案件データのCSV出力

#### API連携
- `GET /projects/{id}/` - 案件詳細取得
- `GET /projects/{id}/companies/` - 案件企業一覧
- `PATCH /projects/{project_id}/companies/{company_id}/` - ステータス更新
- `POST /projects/{id}/bulk_update_status/` - 一括ステータス更新
- `DELETE /projects/{project_id}/companies/{company_id}/` - 企業除外
- `POST /projects/{project_id}/ng_companies/` - 案件NG設定
- `GET /projects/{id}/export_csv/` - CSV出力
- `GET /master/statuses/` - ステータスマスタ

---

## モーダル設計

### 1. 案件選択モーダル
```
┌─────────────────────────────┐
│ 案件に追加 - 42社選択済み    │ [×]
├─────────────────────────────┤
│ ○ 既存案件に追加:           │
│   [案件選択▼____________]   │
│                             │
│ ○ 新規案件作成:             │
│   案件名: [______________]  │
│   依頼企業: [____________]  │
│   概要: [________________]  │
│   担当者: [______________]  │
│                             │
│      [キャンセル] [追加]     │
└─────────────────────────────┘
```

### 2. CSVインポートモーダル
```
┌─────────────────────────────┐
│ CSVファイル取り込み          │ [×]
├─────────────────────────────┤
│ ファイル選択:               │
│ [ファイル選択] companies.csv│
│                             │
│ 進行状況:                   │
│ ████████████████ 100%       │
│                             │
│ 結果:                       │
│ ✓ 150件取り込み完了         │
│ ⚠ 5件エラー                 │
│                             │
│         [閉じる]            │
└─────────────────────────────┘
```

---

## データフロー

### 認証フロー
1. ログイン画面でメール・パスワード入力
2. `/auth/login` API呼び出し
3. JWTトークン取得・保存（localStorage）
4. 以降のAPI呼び出しでBearer Token設定
5. トークン期限切れ時は `/auth/refresh` で更新

### 企業データフロー
1. 企業リスト画面読み込み時: `/companies/` API呼び出し
2. 検索・フィルタ変更時: パラメータ付きでAPI再呼び出し
3. 企業選択・案件追加時: `/projects/{id}/add_companies/` API呼び出し
4. NG設定変更時: `/companies/{id}/toggle_ng/` API呼び出し

### 案件データフロー
1. 案件詳細画面読み込み時: `/projects/{id}/` と `/projects/{id}/companies/` を並列呼び出し
2. ステータス変更時: `/projects/{project_id}/companies/{company_id}/` PATCH呼び出し
3. 一括更新時: `/projects/{id}/bulk_update_status/` POST呼び出し

---

## UI/UXガイドライン

### デザインシステム
- **カラーパレット**: 
  - Primary: Blue (#3B82F6)
  - Secondary: Gray (#6B7280)
  - Success: Green (#10B981)
  - Warning: Orange (#F59E0B)
  - Error: Red (#EF4444)

- **タイポグラフィ**: 
  - 見出し: Inter Bold
  - 本文: Inter Regular
  - 日本語フォールバック: Noto Sans JP

### レスポンシブ
- **デスクトップ**: 1200px以上（メインターゲット）
- **タブレット**: 768px〜1199px
- **モバイル**: 767px以下（基本機能のみ）

### インタラクション
- **ローディング**: スピナー表示
- **成功操作**: トースト通知（緑色）
- **エラー**: トースト通知（赤色）
- **確認ダイアログ**: 削除操作時

---

## パフォーマンス要件

### 表示性能
- **初回読み込み**: 3秒以内
- **検索・フィルタ**: 1秒以内
- **画面遷移**: 500ms以内

### データ処理
- **ページネーション**: 50件/100件/200件
- **無限スクロール**: 不採用（ページネーション優先）
- **キャッシュ**: React Query で5分間キャッシュ

### 最適化
- **画像**: Next.js Image コンポーネント使用
- **バンドルサイズ**: 動的インポート活用
- **API呼び出し**: 重複リクエストの排除

---

## セキュリティ要件

### 認証・認可
- **JWT認証**: アクセストークン + リフレッシュトークン
- **トークン保存**: httpOnly Cookie（推奨）またはlocalStorage
- **自動ログアウト**: 24時間後

### データ保護
- **HTTPS通信**: 必須
- **CSRFプロテクション**: Next.js標準機能使用
- **XSS対策**: sanitize-html使用

---

## 開発ツール・ライブラリ

### 必須ライブラリ
```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "@tanstack/react-query": "^5.0.0",
    "@supabase/supabase-js": "^2.0.0",
    "tailwindcss": "^3.0.0",
    "@radix-ui/react-*": "各種UIコンポーネント",
    "lucide-react": "^0.300.0",
    "react-hook-form": "^7.0.0",
    "zod": "^3.0.0",
    "date-fns": "^2.0.0"
  }
}
```

### 推奨ライブラリ
- **状態管理**: Zustand（複雑な場合）
- **バリデーション**: Zod + React Hook Form
- **日付処理**: date-fns
- **CSV処理**: papaparse
- **通知**: react-hot-toast
- **テーブル**: @tanstack/react-table

---

## デプロイ・運用

### Vercel設定
- **環境変数**:
  - `NEXT_PUBLIC_API_URL`: https://saleslist-mock-api.onrender.com
  - `NEXT_PUBLIC_SUPABASE_URL`: Supabase URL
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase 匿名キー

### 監視・分析
- **Vercel Analytics**: ページビュー・パフォーマンス計測
- **エラーログ**: Console.error をVercelで収集
- **アクセスログ**: Vercel標準ログ使用

---

## 実装優先順位

### Phase 1: 基本機能（2週間）
1. ログイン画面
2. 企業リスト画面（基本表示・検索）
3. 企業詳細画面（表示・編集）

### Phase 2: 高度機能（2週間）
1. 案件管理画面
2. 案件詳細画面
3. CSV機能

### Phase 3: 最適化（1週間）
1. 保存済みフィルタ
2. 一括操作
3. パフォーマンス最適化

この仕様書に基づいて、Vercel v0でのReact/Next.jsアプリケーション開発を進めてください。